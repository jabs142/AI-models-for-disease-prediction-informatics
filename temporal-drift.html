<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Temporal Drift - Sleep Apnea Detection Model</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f7f8fa;
    color: #2c3e50;
    margin: 0;
    padding: 40px 20px 80px;
    line-height: 1.7;
  }
  .container {
    max-width: 900px;
    margin: 0 auto;
  }
  h1 {
    font-size: 1.8em;
    margin-bottom: 0.5em;
    color: #1a1a1a;
    line-height: 1.3;
  }
  .subtitle {
    color: #666;
    font-size: 1em;
    margin-bottom: 50px;
    line-height: 1.8;
  }
  .subtitle strong {
    color: #2c3e50;
  }

  .card {
    background: white;
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    margin-bottom: 40px;
  }

  .card-header {
    font-weight: 600;
    font-size: 1.2em;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #1a1a1a;
  }

  .section-description {
    color: #666;
    font-size: 0.95em;
    margin-bottom: 25px;
    line-height: 1.7;
    font-style: italic;
  }

  .badge {
    font-size: 0.7em;
    padding: 6px 14px;
    border-radius: 12px;
    font-weight: 500;
  }
  .badge.deployed { background: #e3f2fd; color: #1976d2; }
  .badge.warning { background: #fff3e0; color: #f57c00; }
  .badge.critical { background: #ffebee; color: #c62828; }

  #performanceChart {
    height: 280px;
    position: relative;
    margin-bottom: 30px;
  }

  #monthControl {
    width: 100%;
    margin: 30px 0;
  }

  .month-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.9em;
    color: #666;
    margin-bottom: 15px;
  }

  .accuracy-display {
    text-align: center;
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    margin: 30px 0;
  }

  .accuracy-value {
    font-size: 3.5em;
    font-weight: bold;
    margin: 10px 0;
  }

  .accuracy-label {
    font-size: 1.1em;
    opacity: 0.9;
  }

  .alert-box {
    padding: 20px 24px;
    border-radius: 10px;
    margin-top: 30px;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 0.95em;
    line-height: 1.6;
  }
  .alert-box.warning {
    background: #fff3cd;
    border: 1px solid #ffc107;
    color: #856404;
  }
  .alert-box.critical {
    background: #f8d7da;
    border: 1px solid #dc3545;
    color: #721c24;
  }

  /* Collapsible Section Styling */
  .collapsible-section {
    margin: 50px 0;
  }

  .collapsible-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 18px 24px;
    background: white;
    border: 2px solid #dee2e6;
    border-radius: 12px;
    font-size: 1em;
    font-weight: 600;
    color: #495057;
    cursor: pointer;
    transition: all 0.3s;
    text-align: left;
  }
  .collapsible-toggle:hover {
    border-color: #667eea;
    color: #667eea;
    background: #f8f9fa;
  }

  .collapsible-arrow {
    font-size: 1.2em;
    transition: transform 0.3s;
    color: #667eea;
  }
  .collapsible-arrow.open {
    transform: rotate(90deg);
  }

  .collapsible-content {
    display: none;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 40px;
    margin-top: 15px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  }
  .collapsible-content.visible {
    display: block;
  }

  /* Detailed Analysis Layout */
  .analysis-layout {
    display: grid;
    grid-template-columns: 3fr 1fr;
    gap: 25px;
    margin-bottom: 40px;
  }

  .analysis-panel {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 25px;
  }

  .panel-title {
    font-weight: 600;
    font-size: 1.1em;
    margin-bottom: 20px;
    color: #2c3e50;
  }

  #detailedChart {
    height: 280px;
    position: relative;
    margin-bottom: 15px;
  }

  .metrics-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-bottom: 30px;
  }

  .metric-card {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    border-left: 4px solid #dee2e6;
    text-align: center;
  }
  .metric-card.good { border-left-color: #28a745; }
  .metric-card.warning { border-left-color: #ffc107; }
  .metric-card.bad { border-left-color: #dc3545; }

  .metric-value {
    font-size: 1.8em;
    font-weight: bold;
    color: #2c3e50;
  }
  .metric-label {
    font-size: 0.85em;
    color: #6c757d;
    margin-top: 8px;
  }

  .drift-factors {
    margin-top: 30px;
  }
  .drift-factors-header {
    font-weight: 600;
    font-size: 1.1em;
    margin-bottom: 20px;
    color: #2c3e50;
  }
  .factor-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 18px;
    margin: 15px 0;
    background: #f8f9fa;
    border-radius: 10px;
    font-size: 0.95em;
    transition: opacity 0.3s;
  }
  .factor-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4em;
    flex-shrink: 0;
  }

  .recommendations {
    margin-top: 30px;
    padding-top: 25px;
    border-top: 1px solid #e9ecef;
  }
  .recommendations-header {
    font-weight: 600;
    margin-bottom: 15px;
    font-size: 1em;
    color: #2c3e50;
  }

  .patient-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
    margin-top: 20px;
  }
  .patient-table th {
    text-align: left;
    padding: 14px 12px;
    background: #f8f9fa;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
  }
  .patient-table td {
    padding: 14px 12px;
    border-bottom: 1px solid #e9ecef;
  }
  .patient-table tr:hover {
    background: #f8f9fa;
  }

  .prediction-badge {
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.85em;
    font-weight: 500;
  }
  .correct { background: #d4edda; color: #155724; }
  .incorrect { background: #f8d7da; color: #721c24; }

  .back-button {
    display: inline-block;
    margin-bottom: 30px;
    padding: 10px 20px;
    background: #2c3e50;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-size: 0.9em;
    font-weight: 500;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .back-button:hover {
    background: #1a252f;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  canvas {
    width: 100%;
    height: 100%;
  }

  .deep-dive-content h4 {
    color: #2c3e50;
    margin-top: 30px;
    margin-bottom: 15px;
    font-size: 1.1em;
  }
  .deep-dive-content p {
    margin-bottom: 1.2em;
    color: #495057;
  }
  .deep-dive-content ul {
    padding-left: 25px;
    margin-bottom: 1.2em;
  }
  .deep-dive-content li {
    margin-bottom: 8px;
  }

  .key-takeaway {
    background: #e8f5e9;
    padding: 20px 25px;
    border-left: 5px solid #28a745;
    border-radius: 8px;
    margin-top: 30px;
  }

  .prompt-text {
    color: #495057;
    font-size: 0.95em;
    line-height: 1.8;
  }
</style>
</head>
<body>

<div class="container">
  <a href="index.html" class="back-button">‚Üê Back to Home</a>

  <h1>üî¨ Wearable Sleep Apnea Detection Model - Drift Monitor</h1>
  <div class="subtitle">
    <strong>What this teaches:</strong> AI models don't stay accurate forever‚Äîthey "drift" over time as patients age, medications change, and devices update. This shows exactly when retraining is needed.<br>
    <strong>Why it matters for healthcare:</strong> A model that's 91% accurate at deployment could be dangerously unreliable 18 months later without intervention.
  </div>

  <!-- SIMPLE DIAGRAM -->
  <div class="card">
    <div class="card-header">
      Model Performance Over Time
      <span class="badge deployed" id="statusBadge">Deployed</span>
    </div>

    <canvas id="performanceChart"></canvas>

    <div class="month-label">
      <span>Jan 2024</span>
      <span id="currentMonth">Jan 2024</span>
      <span>Dec 2025</span>
    </div>
    <input type="range" id="monthControl" min="0" max="24" step="1" value="0">

    <div class="accuracy-display">
      <div class="accuracy-label">Current Model Accuracy</div>
      <div class="accuracy-value" id="accuracyValue">91.2%</div>
      <div class="accuracy-label" style="font-size: 0.95em; margin-top: 10px;">
        <span id="monthDisplay">Month 0</span> since deployment
      </div>
    </div>

    <div class="alert-box warning" id="alertBox" style="display: none;">
      <span style="font-size: 1.5em;">‚ö†Ô∏è</span>
      <div id="alertText"></div>
    </div>

    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
      <div style="font-weight: 600; font-size: 0.95em; margin-bottom: 15px; color: #2c3e50;">Model Status Legend:</div>
      <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="badge deployed">Deployed</span>
          <span style="font-size: 0.9em; color: #666;">Accuracy within 3% of baseline</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="badge warning">Monitoring</span>
          <span style="font-size: 0.9em; color: #666;">Accuracy dropped 3-8%</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="badge critical">Action Required</span>
          <span style="font-size: 0.9em; color: #666;">Accuracy dropped 8%+, retraining needed</span>
        </div>
      </div>
    </div>
  </div>


  <!-- COLLAPSIBLE: TECHNICAL DEEP DIVE -->
  <div class="collapsible-section">
    <button class="collapsible-toggle" onclick="toggleDeepDive()">
      <span>üìö Technical Deep Dive: Understanding Temporal Drift</span>
      <span class="collapsible-arrow" id="deepDiveArrow">‚Ä∫</span>
    </button>

    <div class="collapsible-content deep-dive-content" id="deepDiveContent">
      <h4>What Is Temporal Drift?</h4>
      <p>
        <strong>Temporal drift</strong> (also called model degradation or concept drift) occurs when the statistical properties of production data differ from training data. Unlike sudden failures, drift is gradual‚Äîaccuracy erodes over weeks or months.
      </p>

      <p>You might be seeing <strong>combined drift</strong> from multiple sources:</p>
      <ul>
        <li><strong>Cohort aging:</strong> Average patient age increases from 48.2 to 50.1 years, changing heart rate and HRV distributions.</li>
        <li><strong>Medication changes:</strong> 12% of patients start CPAP therapy by month 6, fundamentally altering sleep patterns.</li>
        <li><strong>Seasonal patterns:</strong> Winter sleep disruption creates temporary drift the model wasn't exposed to.</li>
        <li><strong>Device updates:</strong> Firmware changes after month 12 subtly shift sensor calibration.</li>
      </ul>

      <h4>How to Detect Drift in Practice</h4>
      <ul>
        <li><strong>Performance Monitoring:</strong> Track accuracy, sensitivity, specificity on held-out test sets. Investigate when metrics drop beyond thresholds.</li>
        <li><strong>Distribution Monitoring:</strong> Use statistical tests (Kolmogorov-Smirnov, Population Stability Index) to detect when input distributions shift.</li>
        <li><strong>Prediction Monitoring:</strong> Watch for changes in prediction distributions that deviate from baseline prevalence.</li>
      </ul>

      <h4>Mitigation Strategies</h4>
      <ul>
        <li><strong>Scheduled Retraining:</strong> Retrain every N months with recent data. This demo suggests retraining when accuracy drops 3-5% (around month 6-12).</li>
        <li><strong>Online Learning:</strong> Continuously update with new labeled data (requires robust feedback loops).</li>
        <li><strong>Drift-Aware Architectures:</strong> Use domain adaptation or models that explicitly account for temporal dynamics.</li>
      </ul>

      <h4>Real-World Example</h4>
      <p>
        COVID-19 diagnostic models trained in March 2020 had <strong>30-40% accuracy drops</strong> by September 2020 due to changing virus strains, testing protocols, and demographics. Without retraining, these models would have been dangerously unreliable.
      </p>

      <div class="key-takeaway">
        <strong>Key Takeaway:</strong> Deployment is not the end‚Äîit's the beginning. Every production ML model needs monitoring and maintenance. For healthcare applications, a model that was 91% accurate could be dangerously unreliable 18 months later without intervention.
      </div>
    </div>
  </div>

  <!-- COLLAPSIBLE: VIEW PROMPT -->
  <div class="collapsible-section">
    <button class="collapsible-toggle" onclick="togglePrompt()">
      <span>üìã View Prompt Used to Generate This Demo</span>
      <span class="collapsible-arrow" id="promptArrow">‚Ä∫</span>
    </button>

    <div class="collapsible-content" id="promptContent">
      <div class="prompt-text">
        "Create an interactive website (HTML file only) to teach the concept of <strong>temporal drift</strong> in AI models for healthcare. The tool should teach learners that AI models degrade over time as the real-world data distribution shifts from the training data, and that ongoing monitoring and retraining is essential for safe deployment.
        <br><br>
        The tool should simulate a wearable-based sleep apnea detection model deployed in January 2024. Learners should move a time slider from month 0 to month 24 and observe how model accuracy gradually decreases from 91% to around 75% as multiple drift factors accumulate: (1) patient cohort aging, (2) medication/treatment adoption (CPAP therapy), (3) seasonal patterns affecting sleep, and (4) device firmware updates changing sensor calibration.
        <br><br>
        The visualization should show a performance line chart over time with a slider control. Display current accuracy prominently, and trigger alert boxes when accuracy drops below thresholds (yellow warning at 3-5% drop, red critical at 8%+ drop).
        <br><br>
        Keep the interface focused on the core concept: one slider, one chart, one key metric (accuracy displayed large and clear). Use generous spacing for comfortable reading.
        <br><br>
        The key learning: deployment is not the end‚Äîmodels need continuous monitoring and periodic retraining to remain safe and effective in healthcare applications."
      </div>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById('performanceChart');
const ctx = canvas.getContext('2d');
const monthControl = document.getElementById('monthControl');

canvas.width = canvas.offsetWidth * window.devicePixelRatio;
canvas.height = canvas.offsetHeight * window.devicePixelRatio;
ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
const width = canvas.offsetWidth;
const height = canvas.offsetHeight;

// Performance data with drift
const months = Array.from({length: 25}, (_, i) => i);
const baselineAccuracy = 91.2;
const baselineSensitivity = 88.5;
const baselineSpecificity = 93.1;

const performanceData = months.map(m => {
  const agingEffect = m * 0.15;
  const medicationEffect = m > 6 ? (m - 6) * 0.12 : 0;
  const seasonalVariation = Math.sin(m / 6 * Math.PI) * 1.2;
  const deviceDrift = m > 12 ? (m - 12) * 0.08 : 0;
  const totalDrift = agingEffect + medicationEffect + deviceDrift;

  return {
    month: m,
    accuracy: Math.max(72, baselineAccuracy - totalDrift + seasonalVariation),
    sensitivity: Math.max(68, baselineSensitivity - totalDrift * 1.1 + seasonalVariation * 0.8),
    specificity: Math.max(75, baselineSpecificity - totalDrift * 0.9 + seasonalVariation * 0.5),
    f1: function() {
      const prec = this.sensitivity;
      const rec = this.sensitivity;
      return 2 * (prec * rec) / (prec + rec) / 100;
    }
  };
});

function drawChart(currentMonth) {
  ctx.clearRect(0, 0, width, height);

  const padding = { top: 20, right: 20, bottom: 40, left: 50 };
  const plotWidth = width - padding.left - padding.right;
  const plotHeight = height - padding.top - padding.bottom;

  // Grid
  ctx.strokeStyle = '#e9ecef';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = padding.top + (plotHeight / 4) * i;
    ctx.beginPath();
    ctx.moveTo(padding.left, y);
    ctx.lineTo(padding.left + plotWidth, y);
    ctx.stroke();
  }

  // Y-axis labels
  ctx.fillStyle = '#6c757d';
  ctx.font = '11px sans-serif';
  ctx.textAlign = 'right';
  [95, 90, 85, 80, 75].forEach((val, i) => {
    const y = padding.top + (plotHeight / 4) * i;
    ctx.fillText(val + '%', padding.left - 10, y + 4);
  });

  // Accuracy line
  ctx.strokeStyle = '#3498db';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  performanceData.forEach((d, i) => {
    const x = padding.left + (i / 24) * plotWidth;
    const y = padding.top + plotHeight * (1 - (d.accuracy - 70) / 25);
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();

  // Current month marker
  const currentX = padding.left + (currentMonth / 24) * plotWidth;
  ctx.strokeStyle = '#495057';
  ctx.lineWidth = 2;
  ctx.setLineDash([3, 3]);
  ctx.beginPath();
  ctx.moveTo(currentX, padding.top);
  ctx.lineTo(currentX, padding.top + plotHeight);
  ctx.stroke();
  ctx.setLineDash([]);

  // Legend
  ctx.font = '12px sans-serif';
  ctx.fillStyle = '#3498db';
  ctx.fillRect(padding.left, height - 25, 15, 3);
  ctx.fillStyle = '#495057';
  ctx.textAlign = 'left';
  ctx.fillText('Model Accuracy', padding.left + 20, height - 20);
}

function updateDashboard() {
  const month = parseInt(monthControl.value);
  const data = performanceData[month];

  const monthNames = ['Jan 2024', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',
                      'Jan 2025', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec 2025'];
  document.getElementById('currentMonth').textContent = monthNames[month];
  document.getElementById('monthDisplay').textContent = `Month ${month}`;

  document.getElementById('accuracyValue').textContent = data.accuracy.toFixed(1) + '%';

  const accuracyDrop = baselineAccuracy - data.accuracy;

  const statusBadge = document.getElementById('statusBadge');
  const alertBox = document.getElementById('alertBox');
  const alertText = document.getElementById('alertText');

  if (accuracyDrop < 3) {
    statusBadge.className = 'badge deployed';
    statusBadge.textContent = 'Deployed';
    alertBox.style.display = 'none';
  } else if (accuracyDrop < 8) {
    statusBadge.className = 'badge warning';
    statusBadge.textContent = 'Monitoring';
    alertBox.className = 'alert-box warning';
    alertBox.style.display = 'flex';
    alertText.innerHTML = `<strong>Performance drift detected:</strong> Accuracy dropped ${accuracyDrop.toFixed(1)}%. Consider retraining with recent data.`;
  } else {
    statusBadge.className = 'badge critical';
    statusBadge.textContent = 'Action Required';
    alertBox.className = 'alert-box critical';
    alertBox.style.display = 'flex';
    alertText.innerHTML = `<strong>Critical drift:</strong> Accuracy dropped ${accuracyDrop.toFixed(1)}%. Model retraining required immediately.`;
  }

  drawChart(month);
}

function toggleDeepDive() {
  const content = document.getElementById('deepDiveContent');
  const arrow = document.getElementById('deepDiveArrow');
  content.classList.toggle('visible');
  arrow.classList.toggle('open');
}

function togglePrompt() {
  const content = document.getElementById('promptContent');
  const arrow = document.getElementById('promptArrow');
  content.classList.toggle('visible');
  arrow.classList.toggle('open');
}

monthControl.addEventListener('input', updateDashboard);
updateDashboard();
</script>

</body>
</html>