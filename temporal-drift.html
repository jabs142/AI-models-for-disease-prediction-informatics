<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Temporal Drift - Sleep Apnea Detection Model</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f7f8fa;
    color: #2c3e50;
    margin: 0;
    padding: 20px;
    line-height: 1.6;
  }
  .container {
    max-width: 1000px;
    margin: 0 auto;
  }
  h1 {
    font-size: 1.4em;
    margin-bottom: 0.3em;
    color: #1a1a1a;
  }
  .subtitle {
    color: #666;
    font-size: 0.9em;
    margin-bottom: 20px;
  }
  .back-button {
    display: inline-block;
    margin-bottom: 15px;
    padding: 8px 16px;
    background: #3498db;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 0.85em;
    font-weight: 500;
  }
  .back-button:hover {
    background: #2980b9;
  }

  /* Slider section */
  .slider-section {
    background: white;
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  .slider-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.85em;
    color: #666;
    margin-bottom: 8px;
  }
  .slider-labels .current {
    font-weight: 600;
    color: #3498db;
  }
  input[type="range"] {
    width: 100%;
    margin: 0;
  }

  /* Main grid */
  .main-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
  }

  .panel {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  .panel-title {
    font-weight: 600;
    font-size: 0.95em;
    margin-bottom: 12px;
    color: #2c3e50;
  }

  /* Age chart */
  #ageChart {
    width: 100%;
    height: 160px;
  }
  .age-stats {
    display: flex;
    justify-content: space-between;
    font-size: 0.85em;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #eee;
  }
  .age-stat {
    text-align: center;
  }
  .age-stat-value {
    font-weight: 600;
    font-size: 1.1em;
  }
  .age-stat-label {
    color: #666;
    font-size: 0.9em;
  }

  /* Accuracy panel */
  .accuracy-panel {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
  }
  .accuracy-value {
    font-size: 2.8em;
    font-weight: bold;
    color: #2c3e50;
    line-height: 1;
  }
  .accuracy-change {
    font-size: 1.1em;
    margin: 8px 0;
  }
  .accuracy-change.good { color: #28a745; }
  .accuracy-change.warning { color: #f57c00; }
  .accuracy-change.critical { color: #dc3545; }
  .badge {
    font-size: 0.75em;
    padding: 5px 12px;
    border-radius: 12px;
    font-weight: 500;
    margin: 8px 0;
  }
  .badge.deployed { background: #e3f2fd; color: #1976d2; }
  .badge.warning { background: #fff3e0; color: #f57c00; }
  .badge.critical { background: #ffebee; color: #c62828; }
  .outside-range {
    font-size: 0.85em;
    color: #666;
    margin-top: 5px;
  }

  /* Feature drift panel */
  .feature-panel {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 15px;
  }
  .feature-panel-title {
    font-weight: 600;
    font-size: 0.95em;
    margin-bottom: 15px;
    color: #2c3e50;
  }
  .feature-row {
    display: grid;
    grid-template-columns: 100px 1fr 80px;
    align-items: center;
    gap: 15px;
    margin-bottom: 12px;
  }
  .feature-name {
    font-weight: 600;
    font-size: 0.9em;
  }
  .feature-name span {
    font-weight: 400;
    color: #666;
    font-size: 0.85em;
    display: block;
  }
  .feature-chart {
    height: 50px;
    position: relative;
  }
  .feature-weight {
    text-align: right;
    font-size: 0.85em;
  }
  .feature-weight-value {
    font-weight: 600;
    font-family: monospace;
  }
  .feature-weight-label {
    color: #666;
    font-size: 0.8em;
  }
  .feature-explanation {
    font-size: 0.85em;
    color: #666;
    padding: 10px 12px;
    background: #f8f9fa;
    border-radius: 6px;
    margin-top: 5px;
    margin-bottom: 15px;
    border-left: 3px solid #3498db;
  }

  /* Collapsible section */
  .collapsible-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 12px 16px;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 0.9em;
    font-weight: 600;
    color: #495057;
    cursor: pointer;
  }
  .collapsible-toggle:hover {
    border-color: #3498db;
    color: #3498db;
  }
  .collapsible-arrow {
    transition: transform 0.2s;
    color: #3498db;
  }
  .collapsible-arrow.open {
    transform: rotate(90deg);
  }
  .collapsible-content {
    display: none;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-top: 10px;
  }
  .collapsible-content.visible {
    display: block;
  }
  .collapsible-content h4 {
    color: #2c3e50;
    margin-top: 20px;
    margin-bottom: 10px;
    font-size: 1em;
  }
  .collapsible-content h4:first-child {
    margin-top: 0;
  }
  .collapsible-content p {
    margin-bottom: 1em;
    color: #495057;
    font-size: 0.9em;
  }
  .collapsible-content ul {
    padding-left: 20px;
    margin-bottom: 1em;
    font-size: 0.9em;
  }
  .collapsible-content li {
    margin-bottom: 6px;
  }
  .key-takeaway {
    background: #e8f5e9;
    padding: 15px 18px;
    border-left: 4px solid #28a745;
    border-radius: 6px;
    margin-top: 20px;
    font-size: 0.9em;
  }

  canvas {
    display: block;
  }
</style>
</head>
<body>

<div class="container">
  <a href="index.html" class="back-button">← Back to Home</a>

  <h1>Why Models Fail: Temporal Drift</h1>
  <div class="subtitle">
    Watch how changing patient demographics degrade model accuracy over time
  </div>

  <!-- Slider control -->
  <div class="slider-section">
    <div class="slider-labels">
      <span>Jan 2024</span>
      <span class="current" id="currentMonth">Jan 2024</span>
      <span>Dec 2025</span>
    </div>
    <input type="range" id="monthControl" min="0" max="24" step="1" value="0">
  </div>

  <!-- Main content: Age distribution + Accuracy -->
  <div class="main-grid">
    <div class="panel">
      <div class="panel-title">Patient Age Distribution</div>
      <canvas id="ageChart"></canvas>
      <div class="age-stats">
        <div class="age-stat">
          <div class="age-stat-value" style="color: #3498db;">48 yr</div>
          <div class="age-stat-label">Training avg</div>
        </div>
        <div class="age-stat">
          <div class="age-stat-value" id="currentAvgAge" style="color: #e74c3c;">48 yr</div>
          <div class="age-stat-label">Current avg</div>
        </div>
        <div class="age-stat">
          <div class="age-stat-value" id="outsidePercent">0%</div>
          <div class="age-stat-label">Outside range</div>
        </div>
      </div>
    </div>

    <div class="panel accuracy-panel">
      <div class="accuracy-value" id="accuracyValue">91.2%</div>
      <div class="accuracy-change good" id="accuracyChange">Baseline</div>
      <span class="badge deployed" id="statusBadge">Deployed</span>
      <div class="outside-range" id="statusText">Model performing well</div>
    </div>
  </div>

  <!-- Feature drift panel -->
  <div class="feature-panel">
    <div class="feature-panel-title">Feature Drift: Why Age Shift Breaks the Model</div>

    <div class="feature-row">
      <div class="feature-name">
        HRV
        <span>Heart Rate Var.</span>
      </div>
      <canvas id="hrvChart" class="feature-chart"></canvas>
      <div class="feature-weight">
        <div class="feature-weight-value">-0.38</div>
        <div class="feature-weight-label">model weight</div>
      </div>
    </div>
    <div class="feature-explanation" id="hrvExplanation">
      Training: 45ms avg | Current: 45ms avg — Lower HRV signals apnea risk, but elderly naturally have lower HRV even when healthy
    </div>

    <div class="feature-row">
      <div class="feature-name">
        BMI
        <span>Body Mass Index</span>
      </div>
      <canvas id="bmiChart" class="feature-chart"></canvas>
      <div class="feature-weight">
        <div class="feature-weight-value">+0.65</div>
        <div class="feature-weight-label">model weight</div>
      </div>
    </div>
    <div class="feature-explanation" id="bmiExplanation">
      Training: 28.5 avg | Current: 28.5 avg — Higher BMI correlates with apnea risk
    </div>
  </div>

  <!-- Collapsible deep dive -->
  <button class="collapsible-toggle" onclick="toggleDeepDive()">
    <span>Technical Deep Dive: Understanding Temporal Drift</span>
    <span class="collapsible-arrow" id="deepDiveArrow">›</span>
  </button>

  <div class="collapsible-content" id="deepDiveContent">
    <h4>What Is Temporal Drift?</h4>
    <p>
      <strong>Temporal drift</strong> occurs when production data differs from training data. Unlike sudden failures, drift is gradual—accuracy erodes over weeks or months as patient populations change.
    </p>

    <h4>Sources of Drift in This Demo</h4>
    <ul>
      <li><strong>Cohort aging:</strong> Average patient age increases, changing heart rate and HRV distributions</li>
      <li><strong>Feature correlation shift:</strong> HRV naturally decreases with age, but the model learned HRV patterns from younger patients</li>
      <li><strong>Population expansion:</strong> Clinic now sees older patients outside the original training demographic</li>
    </ul>

    <h4>How to Detect Drift</h4>
    <ul>
      <li><strong>Performance monitoring:</strong> Track accuracy on held-out test sets over time</li>
      <li><strong>Distribution monitoring:</strong> Use statistical tests to detect when input distributions shift</li>
      <li><strong>Feature monitoring:</strong> Watch for changes in key feature distributions</li>
    </ul>

    <h4>Mitigation Strategies</h4>
    <ul>
      <li><strong>Scheduled retraining:</strong> Retrain every N months with recent data</li>
      <li><strong>Online learning:</strong> Continuously update with new labeled data</li>
      <li><strong>Drift-aware models:</strong> Use domain adaptation techniques</li>
    </ul>

    <div class="key-takeaway">
      <strong>Key Takeaway:</strong> Deployment is not the end—it's the beginning. Every production ML model needs monitoring. A model that was 91% accurate could be dangerously unreliable 18 months later without intervention.
    </div>
  </div>
</div>

<script>
// Canvas setup
const ageCanvas = document.getElementById('ageChart');
const ageCtx = ageCanvas.getContext('2d');
const hrvCanvas = document.getElementById('hrvChart');
const hrvCtx = hrvCanvas.getContext('2d');
const bmiCanvas = document.getElementById('bmiChart');
const bmiCtx = bmiCanvas.getContext('2d');

// Setup canvases for high-DPI
function setupCanvas(canvas) {
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * window.devicePixelRatio;
  canvas.height = rect.height * window.devicePixelRatio;
  const ctx = canvas.getContext('2d');
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
  return { width: rect.width, height: rect.height };
}

const ageDims = setupCanvas(ageCanvas);
const hrvDims = setupCanvas(hrvCanvas);
const bmiDims = setupCanvas(bmiCanvas);

// Feature definitions
const features = {
  hrv: {
    name: 'HRV',
    unit: 'ms',
    weight: -0.38,
    training: { mean: 45, std: 12, min: 15, max: 75 },
    getDrift: (month) => ({
      mean: 45 - month * 0.5,  // HRV decreases as population ages
      std: 12 + month * 0.15
    })
  },
  bmi: {
    name: 'BMI',
    unit: '',
    weight: 0.65,
    training: { mean: 28.5, std: 4.2, min: 18, max: 42 },
    getDrift: (month) => ({
      mean: 28.5 + month * 0.12,  // Slight BMI increase
      std: 4.2 + month * 0.06
    })
  }
};

// Age distribution parameters
const trainingAge = { mean: 48, std: 5, min: 20, max: 80 };
const trainingRange = { min: 40, max: 55 };  // Where model was trained

function getAgeDistribution(month) {
  return {
    mean: 48 + month * 0.35,  // Population ages over time
    std: 5 + month * 0.12     // Distribution widens
  };
}

// Performance calculation
const baselineAccuracy = 91.2;
function getAccuracy(month) {
  const agingEffect = month * 0.18;
  const featureDrift = month > 6 ? (month - 6) * 0.1 : 0;
  const seasonal = Math.sin(month / 6 * Math.PI) * 0.8;
  return Math.max(74, baselineAccuracy - agingEffect - featureDrift + seasonal);
}

// Calculate percentage outside training range
function getOutsidePercentage(month) {
  const dist = getAgeDistribution(month);
  // Approximate using normal CDF
  function normalCDF(x, mean, std) {
    const z = (x - mean) / std;
    const t = 1 / (1 + 0.2316419 * Math.abs(z));
    const d = 0.3989423 * Math.exp(-z * z / 2);
    const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
    return z > 0 ? 1 - p : p;
  }
  const withinRange = normalCDF(trainingRange.max, dist.mean, dist.std) - normalCDF(trainingRange.min, dist.mean, dist.std);
  return Math.round((1 - withinRange) * 100);
}

// Draw normal distribution curve
function drawDistribution(ctx, width, height, mean, std, min, max, color, fillColor) {
  const padding = { top: 5, right: 10, bottom: 5, left: 10 };
  const plotWidth = width - padding.left - padding.right;
  const plotHeight = height - padding.top - padding.bottom;

  // Generate curve points
  const points = [];
  let maxVal = 0;
  for (let x = min; x <= max; x += 0.5) {
    const z = (x - mean) / std;
    const y = Math.exp(-0.5 * z * z) / (std * Math.sqrt(2 * Math.PI));
    maxVal = Math.max(maxVal, y);
    points.push({ x, y });
  }

  // Draw filled area
  ctx.beginPath();
  ctx.moveTo(padding.left, height - padding.bottom);
  points.forEach(p => {
    const px = padding.left + ((p.x - min) / (max - min)) * plotWidth;
    const py = height - padding.bottom - (p.y / maxVal) * plotHeight;
    ctx.lineTo(px, py);
  });
  ctx.lineTo(padding.left + plotWidth, height - padding.bottom);
  ctx.closePath();
  ctx.fillStyle = fillColor;
  ctx.fill();

  // Draw line
  ctx.beginPath();
  points.forEach((p, i) => {
    const px = padding.left + ((p.x - min) / (max - min)) * plotWidth;
    const py = height - padding.bottom - (p.y / maxVal) * plotHeight;
    if (i === 0) ctx.moveTo(px, py);
    else ctx.lineTo(px, py);
  });
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.stroke();

  return { padding, plotWidth, plotHeight, maxVal };
}

// Draw age distribution chart
function drawAgeChart(month) {
  const w = ageDims.width;
  const h = ageDims.height;
  ageCtx.clearRect(0, 0, w, h);

  const padding = { top: 10, right: 15, bottom: 25, left: 15 };
  const plotWidth = w - padding.left - padding.right;
  const plotHeight = h - padding.top - padding.bottom;

  // Get distributions
  const currentDist = getAgeDistribution(month);
  const min = 20, max = 80;

  // Generate both curves
  function getCurvePoints(mean, std) {
    const points = [];
    let maxVal = 0;
    for (let x = min; x <= max; x++) {
      const z = (x - mean) / std;
      const y = Math.exp(-0.5 * z * z) / (std * Math.sqrt(2 * Math.PI));
      maxVal = Math.max(maxVal, y);
      points.push({ x, y });
    }
    return { points, maxVal };
  }

  const training = getCurvePoints(trainingAge.mean, trainingAge.std);
  const current = getCurvePoints(currentDist.mean, currentDist.std);
  const globalMax = Math.max(training.maxVal, current.maxVal);

  // Draw training range shading
  const rangeStartX = padding.left + ((trainingRange.min - min) / (max - min)) * plotWidth;
  const rangeEndX = padding.left + ((trainingRange.max - min) / (max - min)) * plotWidth;
  ageCtx.fillStyle = 'rgba(40, 167, 69, 0.1)';
  ageCtx.fillRect(rangeStartX, padding.top, rangeEndX - rangeStartX, plotHeight);

  // Draw x-axis
  ageCtx.strokeStyle = '#dee2e6';
  ageCtx.lineWidth = 1;
  ageCtx.beginPath();
  ageCtx.moveTo(padding.left, h - padding.bottom);
  ageCtx.lineTo(w - padding.right, h - padding.bottom);
  ageCtx.stroke();

  // X-axis labels
  ageCtx.fillStyle = '#6c757d';
  ageCtx.font = '10px sans-serif';
  ageCtx.textAlign = 'center';
  for (let age = 20; age <= 80; age += 15) {
    const x = padding.left + ((age - min) / (max - min)) * plotWidth;
    ageCtx.fillText(age, x, h - padding.bottom + 14);
  }

  // Training range label
  ageCtx.fillStyle = '#28a745';
  ageCtx.font = '9px sans-serif';
  ageCtx.fillText('Training Range', (rangeStartX + rangeEndX) / 2, padding.top + 12);

  // Helper to draw a curve
  function drawCurve(points, color, fillColor) {
    // Fill
    ageCtx.beginPath();
    ageCtx.moveTo(padding.left, h - padding.bottom);
    points.forEach(p => {
      const px = padding.left + ((p.x - min) / (max - min)) * plotWidth;
      const py = h - padding.bottom - (p.y / globalMax) * plotHeight;
      ageCtx.lineTo(px, py);
    });
    ageCtx.lineTo(w - padding.right, h - padding.bottom);
    ageCtx.closePath();
    ageCtx.fillStyle = fillColor;
    ageCtx.fill();

    // Line
    ageCtx.beginPath();
    points.forEach((p, i) => {
      const px = padding.left + ((p.x - min) / (max - min)) * plotWidth;
      const py = h - padding.bottom - (p.y / globalMax) * plotHeight;
      if (i === 0) ageCtx.moveTo(px, py);
      else ageCtx.lineTo(px, py);
    });
    ageCtx.strokeStyle = color;
    ageCtx.lineWidth = 2.5;
    ageCtx.stroke();
  }

  // Draw training distribution (blue)
  drawCurve(training.points, '#3498db', 'rgba(52, 152, 219, 0.2)');

  // Draw current distribution (red) - only if month > 0
  if (month > 0) {
    drawCurve(current.points, '#e74c3c', 'rgba(231, 76, 60, 0.2)');
  }

  // Legend
  ageCtx.font = '10px sans-serif';
  ageCtx.fillStyle = '#3498db';
  ageCtx.fillRect(w - 100, 8, 12, 3);
  ageCtx.fillStyle = '#495057';
  ageCtx.textAlign = 'left';
  ageCtx.fillText('Training', w - 85, 12);

  if (month > 0) {
    ageCtx.fillStyle = '#e74c3c';
    ageCtx.fillRect(w - 100, 20, 12, 3);
    ageCtx.fillStyle = '#495057';
    ageCtx.fillText('Current', w - 85, 24);
  }
}

// Draw feature distribution chart (mini version)
function drawFeatureChart(ctx, dims, feature, month) {
  const w = dims.width;
  const h = dims.height;
  ctx.clearRect(0, 0, w, h);

  const f = features[feature];
  const current = f.getDrift(month);
  const { min, max } = f.training;

  const padding = { top: 5, right: 8, bottom: 15, left: 8 };
  const plotWidth = w - padding.left - padding.right;
  const plotHeight = h - padding.top - padding.bottom;

  // Generate curves
  function getCurvePoints(mean, std) {
    const points = [];
    let maxVal = 0;
    for (let x = min; x <= max; x += (max - min) / 60) {
      const z = (x - mean) / std;
      const y = Math.exp(-0.5 * z * z) / (std * Math.sqrt(2 * Math.PI));
      maxVal = Math.max(maxVal, y);
      points.push({ x, y });
    }
    return { points, maxVal };
  }

  const training = getCurvePoints(f.training.mean, f.training.std);
  const currentCurve = getCurvePoints(current.mean, current.std);
  const globalMax = Math.max(training.maxVal, currentCurve.maxVal);

  // Helper to draw curve
  function drawCurve(points, color, fillColor) {
    ctx.beginPath();
    ctx.moveTo(padding.left, h - padding.bottom);
    points.forEach(p => {
      const px = padding.left + ((p.x - min) / (max - min)) * plotWidth;
      const py = h - padding.bottom - (p.y / globalMax) * plotHeight;
      ctx.lineTo(px, py);
    });
    ctx.lineTo(w - padding.right, h - padding.bottom);
    ctx.closePath();
    ctx.fillStyle = fillColor;
    ctx.fill();

    ctx.beginPath();
    points.forEach((p, i) => {
      const px = padding.left + ((p.x - min) / (max - min)) * plotWidth;
      const py = h - padding.bottom - (p.y / globalMax) * plotHeight;
      if (i === 0) ctx.moveTo(px, py);
      else ctx.lineTo(px, py);
    });
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.stroke();
  }

  // Draw training (blue)
  drawCurve(training.points, '#3498db', 'rgba(52, 152, 219, 0.15)');

  // Draw current (red) if shifted
  if (month > 0) {
    drawCurve(currentCurve.points, '#e74c3c', 'rgba(231, 76, 60, 0.15)');
  }

  // X-axis labels
  ctx.fillStyle = '#999';
  ctx.font = '9px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText(min + f.unit, padding.left + 10, h - 2);
  ctx.fillText(max + f.unit, w - padding.right - 10, h - 2);
}

// Update all displays
function updateDashboard() {
  const month = parseInt(document.getElementById('monthControl').value);

  // Month label
  const monthNames = ['Jan 2024', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',
                      'Jan 2025', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec 2025'];
  document.getElementById('currentMonth').textContent = monthNames[month];

  // Accuracy
  const accuracy = getAccuracy(month);
  const drop = baselineAccuracy - accuracy;
  document.getElementById('accuracyValue').textContent = accuracy.toFixed(1) + '%';

  const changeEl = document.getElementById('accuracyChange');
  const badgeEl = document.getElementById('statusBadge');
  const statusEl = document.getElementById('statusText');

  if (drop < 1) {
    changeEl.textContent = 'Baseline';
    changeEl.className = 'accuracy-change good';
    badgeEl.textContent = 'Deployed';
    badgeEl.className = 'badge deployed';
    statusEl.textContent = 'Model performing well';
  } else if (drop < 5) {
    changeEl.textContent = '↓ ' + drop.toFixed(1) + '%';
    changeEl.className = 'accuracy-change warning';
    badgeEl.textContent = 'Monitoring';
    badgeEl.className = 'badge warning';
    statusEl.textContent = 'Performance drift detected';
  } else {
    changeEl.textContent = '↓ ' + drop.toFixed(1) + '%';
    changeEl.className = 'accuracy-change critical';
    badgeEl.textContent = 'Action Required';
    badgeEl.className = 'badge critical';
    statusEl.textContent = 'Retraining recommended';
  }

  // Age stats
  const ageDist = getAgeDistribution(month);
  document.getElementById('currentAvgAge').textContent = Math.round(ageDist.mean) + ' yr';
  document.getElementById('outsidePercent').textContent = getOutsidePercentage(month) + '%';

  // Feature explanations
  const hrv = features.hrv.getDrift(month);
  const bmi = features.bmi.getDrift(month);

  document.getElementById('hrvExplanation').textContent =
    `Training: ${features.hrv.training.mean}ms avg | Current: ${hrv.mean.toFixed(0)}ms avg — Lower HRV signals apnea risk, but elderly naturally have lower HRV even when healthy`;

  document.getElementById('bmiExplanation').textContent =
    `Training: ${features.bmi.training.mean} avg | Current: ${bmi.mean.toFixed(1)} avg — Higher BMI correlates with apnea risk`;

  // Draw charts
  drawAgeChart(month);
  drawFeatureChart(hrvCtx, hrvDims, 'hrv', month);
  drawFeatureChart(bmiCtx, bmiDims, 'bmi', month);
}

// Collapsible toggle
function toggleDeepDive() {
  const content = document.getElementById('deepDiveContent');
  const arrow = document.getElementById('deepDiveArrow');
  content.classList.toggle('visible');
  arrow.classList.toggle('open');
}

// Initialize
document.getElementById('monthControl').addEventListener('input', updateDashboard);
updateDashboard();
</script>

</body>
</html>
